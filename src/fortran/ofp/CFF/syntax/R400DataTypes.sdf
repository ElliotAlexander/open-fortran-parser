      
%%%%%%%%%%
%% Fortran ISO/IEC 1539:1991 4xx DataTypes
%%%%%%%%%%

%%module languages/fortran/syntax/R400DataTypes
module R400DataTypes

imports
%%  languages/fortran/syntax/FortranLex
%%  languages/fortran/syntax/R500DataDeclarations
  FortranLex
  R500DataDeclarations

exports

sorts

%%TODO   AcImpliedDo AcValue AcValueList  ArrayConstructor
  BozLiteralConstant ComponentArraySpec ComponentAttrSpec ComponentAttrSpecList ComponentDecl
  ComponentDeclList ComponentDefStmt %%TODO Constant DerivedTypeBody DerivedTypeDef
  DerivedTypeStmt EndTypeStmt %%TODO KindParam LogicalConstant PrivateSequenceStmt
%%TODO   StructureConstructor UnsignedArithmeticConstant   

%%TODO - Add these back above
  DerivedTypeDef DerivedTypeBody PrivateSequenceStmt
  KindParam
  Constant
  TypeAttrSpec TypeAttrSpecList TypeParamName TypeParamNameList ParentTypeName

context-free syntax
%%-R401 lex: signed-digit-string is [sign] digit-string
%%-R402 lex: digit-string is digit [digit]...

%%R404
  Icon '_' KindParam                    -> UnsignedArithmeticConstant

%%R405
  Icon                                  -> KindParam
  NamedConstantUse                      -> KindParam

%%R406
  NamedConstantUse                      -> Constant
  UnsignedArithmeticConstant            -> Constant
  '+' UnsignedArithmeticConstant        -> Constant
  '-' UnsignedArithmeticConstant        -> Constant
  Scon                                  -> Constant
%%  Hcon                                  -> Constant
  LogicalConstant                       -> Constant

%%R420 char-literal-constant
  Icon '_' Scon                         -> Constant
  NamedConstantUse '_' Scon             -> Constant

%%R407
  BinaryConstant                        -> BozLiteralConstant
  OctalConstant                         -> BozLiteralConstant
  HexConstant                           -> BozLiteralConstant

%%R413
  Rcon '_' KindParam                    -> UnsignedArithmeticConstant

%%R421
  '.true.' '_' KindParam                -> LogicalConstant
  '.false.' '_' KindParam               -> LogicalConstant

%%R422
%% TODO: iso defines order: privateseq, componentdef.
  DerivedTypeStmt DerivedTypeBody* EndTypeStmt          -> DerivedTypeDef
  PrivateSequenceStmt                                   -> DerivedTypeBody
  ComponentDefStmt                                      -> DerivedTypeBody

%%R423
  LblDef 'PRIVATE' EOS                                  -> PrivateSequenceStmt
  LblDef 'SEQUENCE' EOS                                 -> PrivateSequenceStmt

%%R424
  LblDef 'TYPE'
             ((',' TypeAttrSpecList)? '::')?
             TypeName
             ('(' TypeParamNameList ')')?                  EOS -> DerivedTypeStmt

  Ident                                                        -> ParentTypeName
  Ident                                                        -> TypeName
  Ident                                                        -> TypeParamName

  {TypeParamName ","}+                                         -> TypeParamNameList

%%R432
  'ABSTRACT'                                                   -> TypeAttrSpec
   AccessSpec                                                  -> TypeAttrSpec
  'BIND'     '(' 'C'            ')'                            -> TypeAttrSpec
  'EXTENDS'  '(' ParentTypeName ')'                            -> TypeAttrSpec

  {TypeAttrSpec ","}+                                          -> TypeAttrSpecList

%%R434
  LblDef 'END' 'TYPE' TypeName?                            EOS -> EndTypeStmt   {cons("end-type-stmt")}

%%R426
  LblDef TypeSpec ( ',' ComponentAttrSpecList )? ':' ':' ComponentDeclList EOS   -> ComponentDefStmt
  LblDef TypeSpec ComponentDeclList EOS                                          -> ComponentDefStmt

%%R427
  {ComponentAttrSpec ","}+                              -> ComponentAttrSpecList
  'POINTER'                                             -> ComponentAttrSpec
  'DIMENSION' '(' ComponentArraySpec ')'                -> ComponentAttrSpec

%%R428
  ExplicitShapeSpecList                                        -> ComponentArraySpec
%%TODO   DeferredShapeSpecList                                 -> ComponentArraySpec

%%R429
%% TODO check with iso def
  ComponentName ('(' ComponentArraySpec ')')? ('*' CharLength)?      -> ComponentDecl
  {ComponentDecl ","}+                                               -> ComponentDeclList

%%R430
%%TODO  TypeName '(' {Expr ","}+ ')'                   -> StructureConstructor

%%R431
%%TODO   '(/' AcValueList '/)'                         -> ArrayConstructor

%%R432
%%  Expr                                        -> AcValueList
%%  AcValueList1                                -> AcValueList
%%  Expr ',' Expr                               -> AcValueList1
%%  Expr ',' AcImpliedDo                        -> AcValueList1
%%  AcImpliedDo                                 -> AcValueList1
%%  AcValueList1 ',' Expr                       -> AcValueList1
%%  AcValueList1 ',' AcImpliedDo                -> AcValueList1
%%TODO   Expr                                          -> AcValue
%%TODO   AcImpliedDo                                   -> AcValue
%%TODO   {AcValue ","}+                                -> AcValueList
   
%%R433
%%TODO   '(' Expr ',' ImpliedDoVariable '=' Expr ',' Expr ')'                  -> AcImpliedDo
%%TODO   '(' Expr ',' ImpliedDoVariable '=' Expr ',' Expr ',' Expr ')'         -> AcImpliedDo
%%TODO   '(' AcImpliedDo ',' ImpliedDoVariable '=' Expr ',' Expr ')'           -> AcImpliedDo
%%TODO   '(' AcImpliedDo ',' ImpliedDoVariable '=' Expr ',' Expr ',' Expr ')'  -> AcImpliedDo
